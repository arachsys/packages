prepare() {
  unpack https://musl.libc.org/releases/musl-1.2.1.tar.gz
  apply paths.patch
  apply usage.patch
  apply wcsnrtombs.patch
  tree 5e8065cf12e36dc687aab5b484be6a78042511be4fff9044c69810c4c2989828
}

build() {
  $SRC/configure --host=$CHOST --build=$CHOST --prefix= \
                 --includedir='$(prefix)/lib/include' \
                 --libdir='$(prefix)/lib/shared' \
                 --syslibdir='$(prefix)/lib' \
                 --disable-wrapper
  mkdir -p $DST/bin $DST/lib
  make install DESTDIR=$DST

  for UTIL in getconf getent iconv; do
    gcc -I$DST/lib/include -L$DST/lib/shared -Os \
      $PKG/$UTIL.c -o $DST/bin/$UTIL
  done

  rm -f $DST/lib/ld-*.so.*
  ln -s shared/libc.so $DST/lib/ld.so
  ln -s ../lib/shared/libc.so $DST/bin/ldd
}
