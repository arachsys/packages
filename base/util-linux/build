mode autotools
enable setuid setgid

prepare() {
  unpack https://www.kernel.org/pub/linux/utils/util-linux/v2.36/util-linux-2.36.1.tar.xz
  apply logger.patch
  apply paths.patch
  tree 5d6b743393a51858650da8e7b28326e98f091d4aa5b1f6a2640b569e68acb8d0
}

config-extra --disable-{chfn-chsh,cramfs,last,lastb,login,lslogins,mesg} \
  --disable-{minix,newgrp,nologin,{pivot,switch}_root,su,utmpdump,vipw,wall} \
  --enable-{line,shared,fs-paths-default=/bin} ADJTIME_PATH=/var/lib/adjtime

post-config() {
  find . -type f -name Makefile | while read FILE; do
    sed -e 's:^\(usrsbin_execdir *=\).*:\1 /bin:' -i $FILE
    sed -e 's:^\(usrlib_execdir *=\).*:\1 /lib:' -i $FILE
    sed -e 's:^\(pkgconfigdir *=\).*:\1 /lib/pkgconfig:' -i $FILE
  done
  sed -e 's:/sbin:/bin:g' -i po/*.{gmo,po,pot}
  sed -e 's:/etc/mtab:/run/mtab:g' -i po/*.{gmo,po,pot}
  sed -e 's:/etc/adjtime:/var/lib/adjtime:g' -i po/*.{gmo,po,pot}
}

post-install() {
  rm -f -r $DST/bin/chkdupexec $DST/lib/{getopt,bash-completion}
}
