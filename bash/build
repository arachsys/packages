mode autotools

check() {
  url https://ftp.gnu.org/gnu/bash/
  match version 5.1 'bash-([0-9]+\.[0-9]+)\.tar\.gz'

  url https://ftp.gnu.org/gnu/bash/bash-5.1-patches/
  match version 5.1.12 'bash51-0*([0-9]+)' '5.1.\1'
}

prepare() {
  unpack https://ftp.gnu.org/gnu/bash/bash-5.1.tar.gz
  set https://ftp.gnu.org/gnu/bash/bash-5.1-patches/bash51-{001..012}
  while [[ $# -gt 0 ]]; do
    apply -p 0 bash-5.1.${1##*-*(0)}.diff $1
    shift
  done
  apply config.diff
  apply paths.diff
  tree 66c5731ced3b1da2bfc9f3fe23aff88ef69658afbbd61b84e6c6be73a0ccb6ab
}

config-extra --without-bash-malloc --with-installed-readline

post-install() {
  ln -f -s bash /dst/bin/sh
  rm -f /dst/bin/bashbug /dst/lib/bash/Makefile.inc
}
