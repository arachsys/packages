check() {
  url https://curl.haxx.se/download/
  match curl 8.6.0 'curl-([0-9.]+)\.tar'

  url https://github.com/nghttp2/nghttp2/tags
  match nghttp2 1.59.0 'tags/v([0-9.]+)\.tar'
}

prepare() {
  unpack https://curl.haxx.se/download/curl-8.6.0.tar.xz
  unpack -d nghttp2 \
    https://github.com/nghttp2/nghttp2/releases/download/v1.59.0/nghttp2-1.59.0.tar.xz
  apply paths.diff
  tree 082b39df2bb5182cd6facf98fe28acbd59a9e4e93def0fbcf66dacce6a502705
}

build() {
  cd /src/nghttp2
  auto-config --disable-shared --enable-lib-only --with-pic
  make

  cd /src
  unexpand curl-config.in >curl-config.in.tmp
  mv -f curl-config.in{.tmp,}
  PATH_SEPARATOR=: auto-config --enable-ipv6 --without-libpsl \
    --with-ca-bundle=/etc/ssl/cert.pem --with-openssl \
    CPPFLAGS="-DUSE_NGHTTP2=1 -I/src/nghttp2/lib/includes" \
    LDFLAGS=-L/src/nghttp2/lib/.libs LIBS=-lnghttp2
  echo install: >docs/Makefile
  echo install: >docs/libcurl/Makefile
  make install DESTDIR=/dst
  rm -f /dst/bin/curl-config /dst/lib/aclocal/libcurl.m4
}
