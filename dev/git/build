enabled nls && require gettext
enabled perl && require perl

prepare() {
  unpack https://www.kernel.org/pub/software/scm/git/git-2.28.0.tar.xz
  apply add-i.patch
  apply filter-branch.patch
  apply usage.patch
  tree 4fd09940c9f98c02d394d64c6b5909bc46dc45a4f65568c99fb1893cce4ab876
}

build() {
  make install DESTDIR=$DST prefix= gitexecdir=/lib/git \
    gitwebdir=/lib/gitweb htmldir=/lib/doc/git infodir=/lib/info \
    mandir=/lib/man template_dir=/lib/git/templates \
    CURL_LDFLAGS=-lcurl NO_{EXPAT,PYTHON,REGEX,TCLTK}=1 \
    $(enabled nls || echo NO_GETTEXT=1) $(enabled perl || echo NO_PERL=1)
  grep -l -r -F -Z 'fatal: git was built without support for' $DST \
    | xargs -0 rm --
  find $DST/lib/git/templates -name '*.sample' -delete
}
