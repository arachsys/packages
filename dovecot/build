mode autotools
enable rpaths

check() {
  url https://dovecot.org/download
  match version 2.3.17.1 'dovecot-([0-9.]+)\.tar'
}

prepare() {
  unpack https://dovecot.org/releases/2.3/dovecot-2.3.17.1.tar.gz
  apply paths.diff
  tree 20a88740c73d03373214fd692432e2f6e998f506a34e9a70b7f7fe7082d478c2
}

config-extra --with-moduledir=/lib/dovecot/modules --with-rundir=/run/dovecot
compile-extra pkglibdir=/lib/dovecot/shared
install-extra pkglibdir=/lib/dovecot/shared

post-install() {
  rm -f /dst/bin/dovecot-sysreport /dst/lib/dovecot/**/{*.a,decode2test.sh}
  rm -f -r /dst/lib/{aclocal,include}
}
