enable rpaths
require perl

check() {
  url https://github.com/dovecot/core/tags
  match version 2.4.2 'tags/([0-9.]+)\.tar'
}

prepare() {
  unpack https://dovecot.org/releases/2.4/dovecot-2.4.2.tar.gz
  apply paths.diff
  apply users.diff
  tree 74621b2d434f63adba2071dff26cd323bcc609b5ae76364eeaf2f1776350640d
}

build() {
  auto-config --with-moduledir=/lib/dovecot/modules \
    --with-rundir=/run/dovecot {ZLIB,ZSTD}_CFLAGS=-I/lib/include \
    ZLIB_LIBS=-lz ZSTD_LIBS=-lzstd
  make install DESTDIR=/dst pkgsysconfdir=/etc/mail \
    pkglibdir=/lib/dovecot/shared

  rm -f -r /dst/bin/dovecot-sysreport /dst/lib/{aclocal,include} \
    /dst/lib/dovecot/gdbserver /dst/lib/dovecot/**/*.{a,py,sh}
}
