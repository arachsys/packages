mode autotools

check() {
  url https://git.kernel.org/pub/scm/fs/ext2/e2fsprogs.git/refs/
  match version 1.46.6 'e2fsprogs-([0-9.]+)\.tar'
}

prepare() {
  unpack https://kernel.org/pub/linux/kernel/people/tytso/e2fsprogs/v1.46.6/e2fsprogs-1.46.6.tar.xz
  apply paths.diff
  tree b9bc0afd7b9687d41f2b1c00f82f5ec6b9282d2cbdf1f2cd2918e80a9c9a20cd
}

config-extra --libexecdir='${prefix}/bin' --disable-libblkid \
  --disable-elf-shlibs --disable-fsck --disable-libuuid --disable-uuidd \
  PKG_CONFIG=/bin/true LDFLAGS="-lblkid -luuid"

if enabled shared; then
  config-extra --enable-elf-shlibs
fi

post-config() {
  sed -i '/^E2SCRUB_DIR *=/s/^/#/' Makefile
}

post-install() {
  make install-libs DESTDIR=/dst
  rm -f /dst/lib/e2initrd_helper
  if ! enabled shared; then
    rm -f -r /dst/bin/{compile_et,mk_cmds} /dst/lib/{et,include,ss,*.a}
  fi
}
