require rust
[[ $CHOST == aarch64-* ]] && require dtc

check() {
  url https://github.com/firecracker-microvm/firecracker/releases
  match version 0.24.5 'tags/v([0-9.]+)\.tar'
}

prepare() {
  unpack firecracker-0.25-20210805.tar.gz \
    https://github.com/firecracker-microvm/firecracker/archive/4f28f888f27bb333c64b499cf5d328bbc317781d.tar.gz
  apply libfdt.patch
  rm -f .cargo/config
  HOME=/tmp cargo fetch --target=$CHOST
  tree c45e8c6e9f924d34188da12c605bac32e349c310e79ad7ae73f568fabe762b41
}

build() {
  HOME=/tmp cargo build --bin firecracker --release
  install -s -D target/release/firecracker /dst/bin/firecracker
}
