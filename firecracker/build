require rust
[[ $CHOST == aarch64-* ]] && require dtc

check() {
  url https://github.com/firecracker-microvm/firecracker/releases
  match version 0.24.5 'tags/v([0-9.]+)\.tar'
}

prepare() {
  unpack firecracker-0.24.5.tar.gz \
    https://github.com/firecracker-microvm/firecracker/archive/refs/tags/v0.24.5.tar.gz
  apply aarch64.patch
  HOME=/tmp cargo fetch --target=$CHOST
  tree c556612a5208086cd47f7faf277abb300cd60e8d60c91cafe4a3f65a79304bf5
}

build() {
  HOME=/tmp cargo build --bin firecracker --release
  install -s -D target/release/firecracker /dst/bin/firecracker
}
