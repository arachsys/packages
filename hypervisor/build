require rust

check() {
  url https://github.com/cloud-hypervisor/cloud-hypervisor/tags
  match version 51.1 'tags/v([0-9.]+)\.tar'
}

prepare() {
  unpack cloud-hypervisor-51.1.tar.xz \
    https://github.com/cloud-hypervisor/cloud-hypervisor/releases/download/v51.1/cloud-hypervisor-v51.1.tar.xz
  apply cosmetic.diff
  apply hotplug.diff
  apply rawimg.diff
  apply tapip.diff
  tree 438a248bea9faa8dca8f4da67f4d0d3c6c3411a8e6e2fe1d93795d29033193c4
}

build() {
  cargo build --bin=cloud-hypervisor --release
  install -s -D target/release/cloud-hypervisor /dst/bin/hypervisor
}
