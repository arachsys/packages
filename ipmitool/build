mode autotools
require autotools

check() {
  url https://codeberg.org/ipmitool/ipmitool/tags
  match version 1.8.19 'archive/IPMITOOL_([0-9]+)_([0-9]+)_([0-9]+)\.tar' '\1.\2.\3'
}

prepare() {
  unpack ipmitool-20230614.tar.gz \
    https://codeberg.org/ipmitool/ipmitool/archive/81b82427.tar.gz
  curl -o enterprise-numbers.gz -L \
    https://ftp.openbsd.org/pub/OpenBSD/distfiles/enterprise-numbers.20220204.gz
  gunzip enterprise-numbers.gz
  apply console.diff
  apply lanplus.diff
  tree d0b5f0909f3adfde144110d93003cea6fa11c9f9fed8fbfdde7646e03a2e7fa9
}

pre-config() {
  bash bootstrap
}

config-extra --disable-intf-{bmc,free,imb,lipmi,serial} \
  IANADIR=/lib/ipmitool IANAUSERDIR=.local/lib/ipmitool

post-install() {
  rm -f /dst/bin/ipmievd /dst/lib/man/*/ipmievd.*
  rm -f /dst/lib/ipmitool/oem_ibm_sel_map
}
