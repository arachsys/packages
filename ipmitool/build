mode autotools
require autotools

check() {
  url https://github.com/ipmitool/ipmitool/tags
  match version 1.8.19 'tags/IPMITOOL_([0-9]+)_([0-9]+)_([0-9]+)\.tar' '\1.\2.\3'
}

prepare() {
  unpack ipmitool-1.8.19.tar.gz \
    https://github.com/ipmitool/ipmitool/archive/refs/tags/IPMITOOL_1_8_19.tar.gz
  curl -o enterprise-numbers.gz -L \
    https://ftp.openbsd.org/pub/OpenBSD/distfiles/enterprise-numbers.20220204.gz
  gunzip enterprise-numbers.gz
  apply console.diff
  apply lanplus.diff
  tree ff47ab824373b96ff610c87807b2866ecb7a37c3d7ddab746cfbcf6948d089d0
}

pre-config() {
  bash bootstrap
}

config-extra --disable-intf-{bmc,free,imb,lipmi,serial} \
  IANADIR=/lib/ipmitool IANAUSERDIR=.local/lib/ipmitool

post-install() {
  rm -f /dst/bin/ipmievd /dst/lib/man/*/ipmievd.*
  rm -f /dst/lib/ipmitool/oem_ibm_sel_map
}
