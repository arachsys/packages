enable setuid

check() {
  url https://github.com/iputils/iputils/tags
  match iputils 20221126 'tags/([0-9.]+)\.tar'
}

prepare() {
  unpack iputils-20230526.tar.gz \
    https://github.com/iputils/iputils/archive/471942de.tar.gz
  apply cosmetic.diff
  apply usage.diff
  tree 685a83c2f9978f93f8b9df42e7644a9145c039bf4c112111736e0aedcd9a1888
}

build() {
  echo '#define PACKAGE_NAME "iputils"' >config.h
  sed 's/@VCS_TAG@/20230526/' git-version.h.meson >>config.h
  cc -Os -Wall -DHAVE___FPENDING -DHAVE_GETRANDOM -I. -include config.h \
    iputils_common.c md5.c ping/*.c -lm -lresolv -o ping/ping
  install -m 4755 -s -D ping/ping /dst/bin/ping
  install -D /pkg/await-net /dst/bin/await-net
}
