require bison flex

check() {
  url https://mirrors.edge.kernel.org/pub/software/network/iw/
  match iw 5.16 'iw-([0-9.]+)\.tar'

  url https://github.com/thom311/libnl/releases
  match libnl 3.6.0 'libnl-([0-9.]+)\.tar'
}

prepare() {
  unpack https://mirrors.edge.kernel.org/pub/software/network/iw/iw-5.16.tar.xz
  unpack -d libnl \
    https://github.com/thom311/libnl/releases/download/libnl3_6_0/libnl-3.6.0.tar.gz
  apply paths.diff
  tree d3d5c2b0defd32b7d1498c3b87b8d95919bc139742ac6a7591ff3a25105da40e
}

build() {
  cd libnl
  /src/libnl/configure --prefix=/src/libs --disable-shared
  make install
  cd /src

  make DESTDIR=/dst PREFIX= SBINDIR=/bin MANDIR=/lib/man NO_PKG_CONFIG=1 \
    CFLAGS="-Os ${CFLAGS} -DCONFIG_LIBNL30 -I/src/libs/include/libnl3" \
    LIBS="-L/src/libs/lib -lnl-genl-3 -lnl-3" install
}
