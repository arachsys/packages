require bison flex

check() {
  url https://mirrors.edge.kernel.org/pub/software/network/iw/
  match iw 5.16 'iw-([0-9.]+)\.tar'

  url https://github.com/thom311/libnl/releases
  match libnl 3.5.0 'libnl-([0-9.]+)\.tar'
}

prepare() {
  unpack https://mirrors.edge.kernel.org/pub/software/network/iw/iw-5.16.tar.xz
  unpack -d libnl \
    https://github.com/thom311/libnl/releases/download/libnl3_5_0/libnl-3.5.0.tar.gz
  apply paths.diff
  tree 82c0d8aba88c7141e3253888f02c96e8eba0d637be94923854eef57c7e82082d
}

build() {
  cd libnl
  /src/libnl/configure --prefix=/src/libs --disable-shared
  make install
  cd /src

  make DESTDIR=/dst PREFIX= SBINDIR=/bin MANDIR=/lib/man NO_PKG_CONFIG=1 \
    CFLAGS="-Os ${CFLAGS} -DCONFIG_LIBNL30 -I/src/libs/include/libnl3" \
    LIBS="-L/src/libs/lib -lnl-genl-3 -lnl-3" install
}
