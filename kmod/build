mode autotools

check() {
  url https://mirrors.edge.kernel.org/pub/linux/utils/kernel/kmod/
  match version 30 'kmod-([0-9.]+)\.tar'
}

prepare() {
  unpack https://mirrors.edge.kernel.org/pub/linux/utils/kernel/kmod/kmod-30.tar.xz
  tree 93a77128aada35b5ab01883b0d7d91832ee9c89236fa2485e6f0325165f1c4f9
}

config-extra --with-{xz,zlib} liblzma_CFLAGS=-I/lib/include \
  liblzma_LIBS=-llzma zlib_CFLAGS=-I/lib/include zlib_LIBS=-lz

post-install() {
  for NAME in depmod insmod lsmod modinfo modprobe rmmod; do
    ln /dst/bin/kmod /dst/bin/$NAME
  done
  rm -f -r /dst/lib/{bash-completion,include,libkmod.*}
}
