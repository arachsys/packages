mode autotools

check() {
  url https://mirrors.edge.kernel.org/pub/linux/utils/kernel/kmod/
  match version 29 'kmod-([0-9.]+)\.tar'
}

prepare() {
  unpack https://mirrors.edge.kernel.org/pub/linux/utils/kernel/kmod/kmod-29.tar.xz
  tree 191d974cc91aff535d0fdfd78b37449ffa00101302f6d4c29c551ecb9dab5fa5
}

config-extra --with-{xz,zlib} liblzma_CFLAGS=-I/lib/include \
  liblzma_LIBS=-llzma zlib_CFLAGS=-I/lib/include zlib_LIBS=-lz

post-install() {
  for NAME in depmod insmod lsmod modinfo modprobe rmmod; do
    ln /dst/bin/kmod /dst/bin/$NAME
  done
  rm -f -r /dst/lib/{bash-completion,include,libkmod.*}
}
