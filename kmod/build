check() {
  url https://mirrors.edge.kernel.org/pub/linux/utils/kernel/kmod/
  match version 31 'kmod-([0-9.]+)\.tar'
}

prepare() {
  unpack https://mirrors.edge.kernel.org/pub/linux/utils/kernel/kmod/kmod-31.tar.xz
  tree b12e075f306b456aa49c37684c8a8687fb102b76ab2afbaa1607ae2ef8e92c4a
}

build() {
  auto-config --with-{xz,zlib} liblzma_CFLAGS=-I/lib/include \
    liblzma_LIBS=-llzma zlib_CFLAGS=-I/lib/include zlib_LIBS=-lz
  make install DESTDIR=/dst
  for NAME in depmod insmod lsmod modinfo modprobe rmmod; do
    ln /dst/bin/kmod /dst/bin/$NAME
  done
  rm -f -r /dst/lib/{bash-completion,include,libkmod.*}
}
