mode autotools
require bison flex libnl-tiny

check() {
  url https://www.tcpdump.org/release/
  match version 1.10.3 'libpcap-([0-9.]+)\.tar'
}

prepare() {
  unpack https://www.tcpdump.org/release/libpcap-1.10.3.tar.gz
  apply libnl.diff
  tree efc6a862223a062426ac4d594db1842dc0776874430dfa0eb786fdf0b75228cb
}

config-extra --with-libnl --with-pcap=linux

post-config() {
  sed -i 's/-lnl-tiny/-Wl,-Bstatic \0 -Wl,-Bdynamic/g' **/Makefile
}

post-install() {
  rm -f /dst/bin/pcap-config
}
