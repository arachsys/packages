mode autotools
require bison flex libnl-tiny

check() {
  url https://www.tcpdump.org/release/
  match version 1.10.1 'libpcap-([0-9.]+)\.tar'
}

prepare() {
  unpack https://www.tcpdump.org/release/libpcap-1.10.1.tar.gz
  apply libnl.diff
  tree 818112f99865e87ba9f1230bd38c6949617c8dc04d7e4ac736f53274d0cdf5a1
}

config-extra --with-pcap=linux

post-config() {
  sed -i 's/-lnl-tiny/-Wl,-Bstatic \0 -Wl,-Bdynamic/g' **/Makefile
}

post-install() {
  rm -f /dst/bin/pcap-config
}
