mode autotools
require bison flex libnl-tiny

check() {
  url https://www.tcpdump.org/release/
  match version 1.10.2 'libpcap-([0-9.]+)\.tar'
}

prepare() {
  unpack https://www.tcpdump.org/release/libpcap-1.10.2.tar.gz
  apply libnl.diff
  tree 174b5869acd8b5b3e896702bfe0e8a26aaa28187e45acd6186e119b941890d6b
}

config-extra --with-libnl --with-pcap=linux

post-config() {
  sed -i 's/-lnl-tiny/-Wl,-Bstatic \0 -Wl,-Bdynamic/g' **/Makefile
}

post-install() {
  rm -f /dst/bin/pcap-config
}
