mode autotools
require libaio

check() {
  url https://sourceware.org/ftp/lvm2/
  match lvm2 2.03.16 'LVM2\.([0-9.]+)\.tgz'
}

prepare() {
  unpack lvm2-2.03.16.tar.gz \
    https://sourceware.org/ftp/lvm2/LVM2.2.03.16.tgz
  apply freopen.diff
  apply mallinfo.diff
  apply static.diff
  apply tidy.diff
  tree 8ced789cb6e649cbf81e9db83937ddb20d304a570fdb5788e8ee25ccaae2242a
}

config-extra --enable-dmfilemapd --without-{cache,thin,vdo} \
  AIO_LIBS='-Wl,-Bstatic -laio -Wl,-Bdynamic'

post-install() {
  rm -f -r /dst/bin/{blkdeactivate,fsadm,lvm_import_vdo,lvmdump} /dst/lib
  find /dst/bin -type l -delete
}
