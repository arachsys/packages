require lmdb perl

check() {
  url https://gitlab.com/muttmua/mutt/-/tags
  match version 2.3.0 'mutt-([0-9.]+) signed'
}

prepare() {
  unpack https://ftp.osuosl.org/pub/mutt/mutt-2.3.0.tar.gz
  apply paths.diff
  tree 585c36fbb5e848f6000ce8e72d2f1d6692a72f58d7744b85ce7e73a5876a44b9
}

build() {
  auto-config --docdir=/lib/doc/mutt --disable-{pgp,smime} \
    --enable-{hcache,imap,pop,sidebar,smtp} --with-{lmdb,ssl} \
    --with-homespool=Maildir SENDMAIL=/bin/sendmail
  sed -i '/MUTTLIBS =/s/-llmdb/-l:liblmdb.a/' Makefile
  make install DESTDIR=/dst
  rm -f /dst/bin/flea /dst/bin/muttbug
}
