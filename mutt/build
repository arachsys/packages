mode autotools
require lmdb perl

check() {
  url https://bitbucket.org/mutt/mutt/downloads/
  match version 2.2.3 'mutt-([0-9.]+)\.tar'
}

prepare() {
  unpack https://bitbucket.org/mutt/mutt/downloads/mutt-2.2.3.tar.gz
  tree 7347ff1ab778998fefb0cb5b7d6086cb68b809182f3f9bfed0f4ff08b6e19fd6
}

config-extra --docdir=/lib/doc/mutt --disable-{pgp,smime} \
  --enable-{hcache,imap,pop,sidebar,smtp} --with-{lmdb,ssl} \
  --with-homespool=Maildir SENDMAIL=/bin/sendmail

post-config() {
  sed -i '/MUTTLIBS =/s/-llmdb/-Wl,-Bstatic \0 -Wl,-Bdynamic/' Makefile
}

post-install() {
  rm -f /dst/bin/flea /dst/bin/muttbug
}
