mode autotools
enable setuid

prepare() {
  unpack https://cdn.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-8.3p1.tar.gz
  apply askpass.patch
  apply dnssegv.patch
  apply sftp.patch
  tree e5d1bf714adaa4eeb08ed6a95258e5d30e79a49479d9cf14d90609a332e2ffbc
}

config-extra --sysconfdir=/etc/ssh --libexecdir=/lib/openssh \
  --disable-{u,w}tmp{,x} --with-lastlog=/var/log/lastlog --with-4in6 \
  --with-default-path=/bin --with-pid-dir=/run \
  --with-privsep-{path=/run/empty,user=ssh} --with-xauth=/bin/xauth

install-reset install-nokeys DESTDIR=$DST

post-install() {
  chmod u+rw,go+r $DST/lib/openssh/*
}
