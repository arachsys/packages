require libevent

check() {
  url https://www.nlnetlabs.nl/downloads/nsd/
  match version 4.8.0 'nsd-([0-9.]+)\.tar'
}

prepare() {
  unpack https://www.nlnetlabs.nl/downloads/nsd/nsd-4.8.0.tar.gz
  apply dbdir.diff
  tree 53ca8bc94effaf86e5d596d727120c464e5674d63ad34a71b95815a6997ab092
}

build() {
  auto-config --enable-root-server --with-dbfile=/var/lib/nsd/nsd.db \
    --with-libevent=/lib --with-pidfile=/run/nsd.pid --with-ssl=/lib \
    --with-user=dns --with-xfrdfile=/var/lib/nsd/xfrd.state \
    --with-zonelistfile=/var/lib/nsd/zone.list
  make install DESTDIR=/dst
}
