mode autotools
require autotools bison

check() {
  url https://cdn.openbsd.org/pub/OpenBSD/OpenNTPD/
  match version 6.8p1 'openntpd-([0-9.]+p[0-9]+)\.tar'
}

prepare() {
  unpack openntpd-portable-20221018-cf202d14.tar.gz \
    https://github.com/openntpd-portable/openntpd-portable/archive/cf202d14.tar.gz
  unpack -d openbsd openntpd-openbsd-20221014-23fa0681.tar.gz \
    https://github.com/openntpd-portable/openntpd-openbsd/archive/23fa0681.tar.gz
  apply update.diff
  tree 28174a226731a2ac750ec7d72cfef993b03c395e6047062b6af3a752ff1b8048
}

pre-config() {
  bash update.sh
  apply adjtimex.diff
  apply cosmetic.diff
  apply paths.diff
  apply settime.diff
  autoreconf -i
}

config-extra --enable-https-constraint --with-privsep-user=ntp
