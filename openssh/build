mode autotools
enable setuid
require libedit

check() {
  url https://cdn.openbsd.org/pub/OpenBSD/OpenSSH/portable/
  match version 8.8p1 'openssh-([0-9.]+p[0-9]+)\.tar'
}

prepare() {
  unpack https://cdn.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-8.8p1.tar.gz
  apply askpass.diff
  apply dnssegv.diff
  apply sftp.diff
  tree 120250d4e2eb0e363aaf435a9b95f261731801cc9eff87e436d1c10228be16a0
}

config-extra --sysconfdir=/etc/ssh --libexecdir=/lib/openssh \
  --disable-lastlog --disable-{u,w}tmp{,x} --with-4in6 \
  --with-default-path=/bin --with-libedit --with-pid-dir=/run \
  --with-privsep-{path=/run/empty,user=ssh} --with-xauth=/bin/xauth

install-reset install-nokeys DESTDIR=/dst

post-install() {
  chmod u+rw,go+r /dst/lib/openssh/*
  echo libedit >>/dst/requirements
}
