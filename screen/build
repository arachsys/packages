mode autotools
enable setuid

check() {
  url https://ftp.gnu.org/gnu/screen/
  match version 4.8.0 'screen-([0-9.]+)\.tar'
}

prepare() {
  unpack https://ftp.gnu.org/gnu/screen/screen-4.8.0.tar.gz
  apply config.diff
  tree 39c2bcff500246e1f3a0756f2eabce91e2647d7a7321b8eebee62d6feece8f79
}

config-extra CFLAGS=-DNONETHACK --enable-{colors256,locale,rxvt_osc,telnet}

post-config() {
  sed -e 's/^#define UTMPOK.*/#undef UTMPOK/' \
      -e 's/^#define GETUTENT.*/#undef GETUTENT/' \
      -i config.h
}

post-install() {
  mv -f /dst/bin/screen{-*,}
}
