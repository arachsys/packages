mode autotools
require libevent

check() {
  url https://dist.torproject.org/
  match version 0.4.6.10 'tor-([0-9.]+)\.tar'
}

prepare() {
  unpack https://dist.torproject.org/tor-0.4.6.10.tar.gz
  apply cosmetic.diff
  apply libressl.diff
  tree 86a8cb69f86b72bf55617a7b2ff3818e9a2016d0e868cc21e9644fc398886d19
}

config-extra --enable-lzma --enable-zstd CONFDIR=/etc \
  {LZMA,ZSTD}_CFLAGS=-I/lib/include LZMA_LIBS=-llzma ZSTD_LIBS=-lzstd

post-config() {
  sed -i 's:-levent:/lib/static/libevent.a:g' Makefile config.rust
}

post-install() {
  rm -f /dst/bin/torify
}
