require libevent

check() {
  url https://dist.torproject.org/
  match version 0.4.8.11 'tor-([0-9.]+)\.tar'
}

prepare() {
  unpack https://dist.torproject.org/tor-0.4.8.11.tar.gz
  apply cosmetic.diff
  apply config.diff
  tree ce05c75fcc99ba405f5d4f42d0767c1bb73f8a9ae7fc8f9d76c262a358deca3b
}

build() {
  auto-config --enable-lzma --enable-zstd CONFDIR=/etc \
    CPPFLAGS=-DDISABLE_ENGINES {LZMA,ZSTD}_CFLAGS=-I/lib/include \
    LZMA_LIBS=-llzma ZSTD_LIBS=-lzstd
  sed -i 's:-levent:/lib/static/libevent.a:g' Makefile
  make install DESTDIR=/dst
  rm -f /dst/bin/torify
}
