mode autotools
require expat

check() {
  url https://nlnetlabs.nl/downloads/unbound/
  match version 1.16.2 'unbound-([0-9.]+)\.tar'
}

prepare() {
  unpack https://nlnetlabs.nl/downloads/unbound/unbound-1.16.2.tar.gz
  tree 3266031b20dd79d82d97b598c2fdaee9d483dc664f821e6275370913ca5056f7
}

config-extra --disable-{rpath,shared} --enable-subnet --with-chroot-dir= \
  --with-conf-file=/etc/unbound.conf --with-{libexpat,ssl}=/lib \
  --with-pidfile=/run/unbound.pid --with-run-dir=/var/lib/unbound \
  --with-username=dns

post-config() {
  sed -i 's/-lexpat/-Wl,-Bstatic,\0,-Bdynamic/' Makefile
}

post-install() {
  rm -f -r /dst/bin/unbound-control-setup /dst/include /dst/lib
  ln -s unbound-host /dst/bin/host
}
